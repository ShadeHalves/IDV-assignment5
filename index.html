<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>IDV Assignment 5 – Integrated A1–A4</title>

  <!-- Global styles for Assignment 5 -->
  <style>
    :root {
      --bg-page: #0b1120;
      --bg-card: #111827;
      --bg-card-alt: #020617;
      --fg-main: #e5e7eb;
      --fg-muted: #9ca3af;
      --accent: #60a5fa;
      --border-subtle: #1f2937;
      --border-strong: #4b5563;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue",
        Arial, "Noto Sans", "PingFang SC", "Microsoft YaHei", sans-serif;
      /* changed to white background */
      background: #ffffff;
      color: #111827;
      line-height: 1.6;
      overflow-x: hidden; /* prevent horizontal scrollbar, per Assignment 5 */
    }

    a {
      color: var(--accent);
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    .site-shell {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px 20px 40px;
    }

    .site-header {
      padding: 16px 20px 20px;
      border-radius: 18px;
      background: linear-gradient(145deg, rgba(37, 99, 235, 0.18), rgba(15, 23, 42, 0.95));
      border: 1px solid rgba(148, 163, 184, 0.35);
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.3);
      margin-bottom: 18px;
      color: #e5e7eb;
    }

    .site-header h1 {
      margin: 0 0 6px;
      font-size: 24px;
      letter-spacing: 0.02em;
    }

    .site-header p {
      margin: 0;
      font-size: 14px;
      color: var(--fg-muted);
    }

    .toc-card {
      margin-top: 16px;
      border-radius: 14px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(55, 65, 81, 0.8);
      padding: 14px 16px 10px;
      font-size: 14px;
      color: var(--fg-main);
    }

    .toc-card strong {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--fg-muted);
    }

    .toc-card ul {
      list-style: none;
      margin: 8px 0 0;
      padding: 0;
      display: flex;
      flex-wrap: wrap;
      gap: 10px 18px;
    }

    .toc-card li a {
      font-size: 14px;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(75, 85, 99, 0.7);
      color: var(--fg-main);
    }

    main {
      margin-top: 18px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    section {
      border-radius: 16px;
      background: rgba(15, 23, 42, 0.96);
      border: 1px solid rgba(31, 41, 55, 0.9);
      padding: 18px 18px 20px;
      color: var(--fg-main);
    }

    section h2 {
      margin-top: 0;
      margin-bottom: 8px;
      font-size: 20px;
    }

    section p {
      margin-top: 4px;
      margin-bottom: 8px;
      font-size: 14px;
      color: var(--fg-muted);
    }

    .section-note {
      font-size: 13px;
      color: var(--fg-muted);
      margin-bottom: 12px;
    }

    /* --- Assignment 1 styles ----------------------- */
    header.assignment1-header {
      background: linear-gradient(to right, #1f2937, #020617);
      padding: 14px 18px;
      border-bottom: 1px solid #1f2937;
      border-radius: 12px 12px 0 0;
    }

    header.assignment1-header h3 {
      margin: 0 0 4px;
      font-size: 18px;
      color: #f9fafb;
    }

    header.assignment1-header p {
      margin: 0;
      font-size: 13px;
      color: #9ca3af;
    }

    .psi-main {
      display: flex;
      flex-direction: column;
      gap: 18px;
      padding: 16px 10px 4px;
    }

    .psi-row {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
    }

    .psi-card {
      flex: 1 1 260px;
      background: radial-gradient(circle at top left, #111827 0, #020617 55%);
      border-radius: 14px;
      padding: 14px 14px 12px;
      box-shadow: 0 4px 18px rgba(0, 0, 0, 0.75);
      border: 1px solid rgba(75, 85, 99, 0.9);
    }

    .psi-card h4 {
      margin: 0 0 6px;
      font-size: 15px;
      color: #e5e7eb;
    }

    .psi-card p {
      margin: 0 0 8px;
      font-size: 13px;
      color: #9ca3af;
    }

    .psi-card button {
      font-size: 13px;
      padding: 5px 10px;
      border-radius: 999px;
      border: 1px solid #4b5563;
      background: #111827;
      color: #e5e7eb;
      cursor: pointer;
    }

    .psi-card button:hover {
      border-color: #60a5fa;
    }

    .psi-card pre {
      background: #020617;
      border-radius: 10px;
      border: 1px solid #1f2937;
      padding: 6px 8px;
      font-size: 12px;
      overflow: auto;
      color: #e5e7eb;
    }

    .psi-table-wrapper {
      background: #020617;
      border-radius: 14px;
      border: 1px solid #1f2937;
      overflow: hidden;
      margin-top: 4px;
    }

    .psi-table-wrapper table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
      color: #e5e7eb;
    }

    .psi-table-wrapper th,
    .psi-table-wrapper td {
      border-bottom: 1px solid #1f2937;
      padding: 4px 6px;
      text-align: left;
      white-space: nowrap;
    }

    .psi-table-wrapper thead {
      background: #111827;
    }

    .psi-table-wrapper tbody tr:nth-child(even) {
      background: #020617;
    }

    .psi-table-wrapper tbody tr:nth-child(odd) {
      background: #020617;
    }

    /* --- Assignment 2 styles ----------------------------- */
    .a2-table {
      border-collapse: collapse;
      width: 100%;
      max-width: 1100px;
      background: #020617;
      table-layout: fixed;
      margin-top: 8px;
      border-radius: 10px;
      overflow: hidden;
    }

    .a2-table col {
      width: 20%;
    }

    .a2-table thead th {
      font-weight: 700;
      background: #111827;
      border-bottom: 1px solid #1f2937;
      padding: 10px;
      color: #e5e7eb;
      font-size: 13px;
    }

    .a2-table td {
      border: 1px solid #1f2937;
      text-align: center;
      padding: 10px;
      vertical-align: middle;
      color: #e5e7eb;
      font-size: 12px;
    }

    .a2-table svg {
      width: 96px;
      height: 96px;
      display: block;
      margin: auto;
      overflow: visible;
    }

    .mirror { transform: scaleX(-1); }
    .rotate180 { transform: rotate(180deg); }
    .squeeze { transform: scaleY(0.5); }
    .gray { filter: grayscale(100%); }

    .c1{fill:#4285F4;stroke:#1b54c8;stroke-width:2}
    .c2{fill:#34A853;stroke:#1e6c39;stroke-width:2}
    .c3{fill:#EA4335;stroke:#9a1c12;stroke-width:2}
    .c4{fill:#FBBC05;stroke:#b98500;stroke-width:2}
    .c5{fill:#7E57C2;stroke:#4e2e8e;stroke-width:2}
    .c6{fill:#00ACC1;stroke:#006773;stroke-width:2}
    .line{fill:none;stroke-width:3;stroke:#e5e7eb}

    /* --- Assignment 3 styles ---------------------- */
    .a3 h3 {
      font-size: 18px;
      margin-top: 6px;
      margin-bottom: 8px;
    }

    .a3 h4 {
      font-size: 16px;
      margin-top: 18px;
      margin-bottom: 8px;
    }

    .chart {
      display: block;
      max-width: 900px;
      width: 100%;
      border: 1px solid #1f2937;
      background: #020617;
    }

    .tooltip {
      position: absolute;
      pointer-events: none;
      padding: 4px 8px;
      background:#0b1120;
      border:1px solid #4b5563;
      font-size:12px;
      border-radius: 4px;
      box-shadow: 0 1px 4px #000000aa;
      color: #e5e7eb;
    }

    figure {
      margin: 12px 0 6px;
    }

    figcaption {
      font-size: 13px;
      color: #9ca3af;
      line-height: 1.45;
      margin-top: 6px;
    }

    figcaption strong {
      color: #e5e7eb;
    }

    .divider {
      margin: 24px 0;
      border: none;
      border-top: 1px solid #1f2937;
    }

    /* --- Assignment 4 styles ---------------------- */
    .a4 h3 {
      font-size: 18px;
      margin-top: 6px;
      margin-bottom: 8px;
    }

    .a4 p {
      font-size: 14px;
      color: #9ca3af;
    }

    .controls {
      margin-bottom: 10px;
      font-size: 13px;
    }

    .controls span {
      font-weight: 600;
      margin-right: 8px;
    }

    button.metric-btn,
    button.dataset-btn {
      border: 1px solid #4b5563;
      background: #020617;
      padding: 4px 10px;
      margin-right: 6px;
      border-radius: 999px;
      cursor: pointer;
      font-size: 13px;
      color: #e5e7eb;
    }

    button.metric-btn.active,
    button.dataset-btn.active {
      background: #3b82f6;
      color: #fff;
      border-color: #3b82f6;
    }

    #summary {
      margin-top: 14px;
      font-size: 13px;
      background: #020617;
      border-radius: 10px;
      padding: 10px 12px;
      border: 1px solid #1f2937;
      max-width: 880px;
    }

    #summary h3 {
      margin: 0 0 4px 0;
      font-size: 14px;
      color: #e5e7eb;
    }

    #summary ul {
      margin: 4px 0 0 16px;
      padding: 0;
      color: #9ca3af;
    }

    /* Simple responsive tweak */
    @media (max-width: 768px) {
      .site-shell {
        padding: 16px 12px 28px;
      }
      .chart {
        max-width: 100%;
      }
    }
  </style>

  <!-- Single D3 include for the whole page (used by A3 & A4) -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
</head>

<body>
  <div class="site-shell">
    <!-- Top header + overview + directory -->
    <header class="site-header">
      <h1>IDV Assignment 5 – Integrated A1–A4</h1>
      <p>
        A single web page combining: A1 (API data table), A2 (SVG transformations),
        A3 (interactive D3 charts), and A4 (grouped bar chart with robustness metrics).
      </p>

      <div class="toc-card">
        <strong>Contents</strong>
        <ul>
          <li><a href="#overview">Overview &amp; integration notes</a></li>
          <li><a href="#a1">Assignment 1 – PSI API Table</a></li>
          <li><a href="#a2">Assignment 2 – SVG Transformations</a></li>
          <li><a href="#a3">Assignment 3 – D3 Chart Collection</a></li>
          <li><a href="#a4">Assignment 4 – Robustness Bar Chart</a></li>
        </ul>
      </div>
    </header>

    <main>
      <!-- Overview section for Assignment 5 -->
      <section id="overview">
        <h2>Overview &amp; Integration Summary</h2>
        <p>
          This Assignment 5 page integrates my work from Assignments 1–4 into one unified
          layout. Each assignment is presented in its own section with a consistent
          card-style background, spacing, and typography, while keeping all original
          functionality intact.
        </p>
        <p>
          The main integration challenges were CSS and JavaScript conflicts. Each
          assignment originally used its own HTML template, separate <code>&lt;body&gt;</code>
          styles, and duplicated class names such as <code>.tooltip</code>. To avoid
          conflicts, I merged the styles into a single stylesheet, removed extra
          <code>body</code> rules, and reused a shared tooltip style across A3 and A4.
          I also ensured that D3 is loaded only once at the top of the page.
        </p>
        <p>
          The hardest part to integrate was Assignment 3 (the multi-chart D3 collection),
          because it contains multiple SVGs, complex transitions, and interactions bound
          to specific IDs. When moving it into this integrated file, I preserved all
          container IDs (<code>#chart1</code>–<code>#chart5</code>) and kept the script
          logic together at the bottom, so all selections and transitions still work
          correctly in the new layout.
        </p>
      </section>

      <!-- ================= Assignment 1 ================= -->
      <section id="a1">
        <h2>Assignment 1 – API-driven PSI Table</h2>
        <p class="section-note">
          This section reuses the Assignment 1 logic to fetch PSI readings from
          data.gov.sg and display them in a table, together with a small JSON preview.
        </p>

        <header class="assignment1-header">
          <h3>Singapore PSI Readings</h3>
          <p>API-driven PSI readings table using the data.gov.sg environment API.</p>
        </header>

        <div class="psi-main">
          <div class="psi-row">
            <article class="psi-card">
              <h4>1. Load PSI data (API)</h4>
              <p>Click to fetch today’s PSI readings JSON from data.gov.sg.</p>
              <button id="btnLoad">Load PSI JSON</button>
              <pre id="jsonPreview">// JSON preview will appear here after loading.</pre>
            </article>

            <article class="psi-card">
              <h4>2. Table interpretation</h4>
              <p>
                The table lists PSI readings by region and pollutant band.
                Values are extracted from the official API response.
              </p>
              <p>
                The card layout and typography are kept similar to the original
                Assignment 1, but wrapped into this unified dark theme.
              </p>
            </article>
          </div>

          <div class="psi-table-wrapper">
            <table id="psiTable">
              <thead>
                <tr>
                  <th>Region</th>
                  <th>o3_sub_index</th>
                  <th>pm10_twenty_four_hourly</th>
                  <th>pm10_sub_index</th>
                  <th>co_sub_index</th>
                  <th>pm25_twenty_four_hourly</th>
                  <th>so2_sub_index</th>
                  <th>co_eight_hour_max</th>
                  <th>no2_one_hour_max</th>
                  <th>so2_twenty_four_hourly</th>
                  <th>pm25_sub_index</th>
                  <th>psi_twenty_four_hourly</th>
                  <th>o3_eight_hour_max</th>
                </tr>
              </thead>
              <tbody>
                <!-- Filled dynamically -->
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- ================= Assignment 2 ================= -->
      <section id="a2">
        <h2>Assignment 2 – 10 SVGs × 5 Effects</h2>
        <p class="section-note">
          This section reuses the sprite-based SVG assignment: 10 base drawings,
          each with five different transformations (mirror, rotate 180°, squeeze,
          gray, and original).
        </p>

        <!-- Hidden sprite sheet from A2 -->
        <svg width="0" height="0" style="position:absolute;left:-9999px;top:-9999px">
          <defs>
            <!-- Sprite symbols -->
            <symbol id="svg-cat" viewBox="0 0 120 120">
              <path class="c1" d="M60 25 L80 10 L78 32 Q95 45 95 63 Q95 85 76 96 Q60 105 45 100 Q25 92 22 73 Q18 50 38 36 L36 14 Z"/>
              <path class="c4" d="M58 63 L62 63 L60 67 Z"/>
              <path class="line" d="M40 63 L15 57 M42 70 L16 75 M80 64 L105 58 M78 72 L104 78"/>
              <path d="M46 52 q5 -6 10 0 q-5 6 -10 0Z" fill="#fff"/>
              <path d="M70 49 q6 -4 11 1 q-6 6 -11 -1Z" fill="#fff"/>
            </symbol>
            <symbol id="svg-dog" viewBox="0 0 120 120">
              <path class="c2" d="M22 40 Q18 25 30 20 L45 25 L55 18 Q72 12 84 25 Q96 38 92 55 Q88 74 70 88 Q60 95 46 94 Q28 93 22 77 Q16 60 22 40 Z"/>
              <path class="line" d="M28 44 Q35 36 44 43 M77 45 Q80 39 88 42"/>
              <circle cx="43" cy="47" r="3" fill="#fff"/>
              <circle cx="75" cy="47" r="3" fill="#fff"/>
              <path class="c4" d="M50 64 Q60 72 70 64"/>
            </symbol>
            <symbol id="svg-ship" viewBox="0 0 120 120">
              <path class="c3" d="M15 78 L105 78 L92 95 L28 95 Z"/>
              <path class="c6" d="M58 78 L58 30 L90 50 L58 50 Z"/>
              <path class="c4" d="M58 34 L75 28 L58 22 Z"/>
              <path class="line" d="M20 95 Q40 102 60 95 Q85 88 100 98"/>
            </symbol>
            <symbol id="svg-flower" viewBox="0 0 120 120">
              <path class="c4" d="M56 65 q8 -20 20 0 q-12 18 -20 0Z"/>
              <path class="c3" d="M60 40 q-12 -10 0 -20 q12 6 8 18 Z"/>
              <path class="c1" d="M82 52 q10 -8 20 4 q-8 12 -18 6 Z"/>
              <path class="c2" d="M36 52 q-12 2 -18 14 q14 4 20 -6 Z"/>
              <path class="c5" d="M62 88 q-6 10 -2 20 q10 -6 8 -18 Z"/>
              <path class="line" d="M60 70 q-6 24 -6 42 M54 90 q-10 6 -16 18"/>
            </symbol>
            <symbol id="svg-house" viewBox="0 0 120 120">
              <path class="c6" d="M20 60 L60 30 L100 60 L100 98 L20 98 Z"/>
              <path class="c4" d="M34 98 L34 76 L50 76 L50 98 Z"/>
              <path class="c3" d="M64 70 L90 70 L90 88 L64 88 Z"/>
            </symbol>
            <symbol id="svg-goat" viewBox="0 0 120 120">
              <path class="c5" d="M25 70 q8 -22 30 -28 q24 -4 38 12 q12 14 5 30 q-6 12 -22 16 q-18 5 -34 -2 q-16 -7 -21 -20 Z"/>
              <path class="line" d="M72 38 q8 -18 22 -10 M60 36 q-4 -14 10 -12 M44 78 L26 82"/>
              <path d="M54 66 q5 -3 9 0 q-4 6 -9 0Z" fill="#fff"/>
              <path class="c3" d="M68 78 q4 2 8 0 q-4 6 -8 0Z"/>
            </symbol>
            <symbol id="svg-moon" viewBox="0 0 120 120">
              <path class="c4" fill-rule="evenodd" d="M76 18 A42 42 0 1 0 96 96 A28 28 0 1 1 76 18 Z"/>
              <path class="c1" d="M90 34 l6 2 l-4 4 l2 6 l-6 -3 l-6 3 l2 -6 l-4 -4 l6 -2 l2 -6 Z"/>
            </symbol>
            <symbol id="svg-grass" viewBox="0 0 120 120">
              <path class="c2" d="M15 98 q10 -20 6 -40 q14 18 10 40 Z"/>
              <path class="c2" d="M40 98 q10 -28 2 -46 q16 18 14 46 Z"/>
              <path class="c2" d="M65 98 q14 -24 12 -48 q18 20 12 48 Z"/>
              <path class="c2" d="M90 98 q12 -22 4 -38 q14 12 8 38 Z"/>
              <path class="c6" d="M10 98 L110 98 L110 104 L10 104 Z"/>
            </symbol>
            <symbol id="svg-cow" viewBox="0 0 120 120">
              <path class="c4" d="M20 70 q8 -24 34 -28 q28 -4 44 12 q12 14 2 30 q-8 14 -26 18 q-22 4 -38 -6 q-18 -10 -16 -26 Z"/>
              <path class="c3" d="M78 58 q16 8 10 22 q-14 -6 -10 -22 Z"/>
              <path d="M46 64 q6 -3 10 0 q-6 6 -10 0Z" fill="#fff"/>
              <path d="M62 63 q6 -3 10 1 q-6 6 -10 -1Z" fill="#fff"/>
              <path class="line" d="M34 80 L18 84"/>
            </symbol>
            <symbol id="svg-fish" viewBox="0 0 120 120">
              <path class="c6" d="M18 70 q20 -22 46 -22 q18 0 32 10 q8 6 8 12 q0 6 -8 12 q-14 10 -32 10 q-26 0 -46 -22 Z"/>
              <path class="c3" d="M86 58 L108 48 L100 70 L108 92 L86 82 Z"/>
              <path d="M56 58 q6 -3 8 3 q-6 4 -8 -3Z" fill="#fff"/>
            </symbol>
            <symbol id="svg-butterfly" viewBox="0 0 300 220">
              <path d="M150 110 C 90 20, 10 40, 40 110 C 10 180, 90 200, 150 110 Z" fill="#4285F4" stroke="#4285F4" stroke-width="2"/>
              <path d="M150 110 C 210 20, 290 40, 260 110 C 290 180, 210 200, 150 110 Z" fill="#34A853" stroke="#34A853" stroke-width="2"/>
              <path d="M150 60 C 145 80, 145 140, 150 160 C 155 140, 155 80, 150 60 Z" fill="#EA4335"/>
              <path d="M150 55 C 160 55, 160 45, 150 45 C 140 45, 140 55, 150 55 Z" fill="#FBBC05"/>
            </symbol>
          </defs>
        </svg>

        <!-- A2 table -->
        <table class="a2-table">
          <colgroup>
            <col><col><col><col><col>
          </colgroup>
          <thead>
            <tr>
              <th>Base SVG</th>
              <th>Original</th>
              <th>Mirror</th>
              <th>Rotate 180°</th>
              <th>Squeeze + Gray</th>
            </tr>
          </thead>
          <tbody>
            <!-- Cat -->
            <tr>
              <td><svg viewBox="0 0 120 120"><use href="#svg-cat"/></svg></td>
              <td><svg viewBox="0 0 120 120" class="mirror"><use href="#svg-cat"/></svg></td>
              <td><svg viewBox="0 0 120 120" class="rotate180"><use href="#svg-cat"/></svg></td>
              <td><svg viewBox="0 0 120 120" class="squeeze"><use href="#svg-cat"/></svg></td>
              <td><svg viewBox="0 0 120 120" class="gray"><use href="#svg-cat"/></svg></td>
            </tr>
            <!-- Butterfly -->
            <tr>
              <td><svg viewBox="0 0 300 220"><use href="#svg-butterfly"/></svg></td>
              <td><svg viewBox="0 0 300 220" class="mirror"><use href="#svg-butterfly"/></svg></td>
              <td><svg viewBox="0 0 300 220" class="rotate180"><use href="#svg-butterfly"/></svg></td>
              <td><svg viewBox="0 0 300 220" class="squeeze"><use href="#svg-butterfly"/></svg></td>
              <td><svg viewBox="0 0 300 220" class="gray"><use href="#svg-butterfly"/></svg></td>
            </tr>
            <!-- Ship -->
            <tr>
              <td><svg viewBox="0 0 120 120"><use href="#svg-ship"/></svg></td>
              <td><svg viewBox="0 0 120 120" class="mirror"><use href="#svg-ship"/></svg></td>
              <td><svg viewBox="0 0 120 120" class="rotate180"><use href="#svg-ship"/></svg></td>
              <td><svg viewBox="0 0 120 120" class="squeeze"><use href="#svg-ship"/></svg></td>
              <td><svg viewBox="0 0 120 120" class="gray"><use href="#svg-ship"/></svg></td>
            </tr>
            <!-- Flower -->
            <tr>
              <td><svg viewBox="0 0 120 120"><use href="#svg-flower"/></svg></td>
              <td><svg viewBox="0 0 120 120" class="mirror"><use href="#svg-flower"/></svg></td>
              <td><svg viewBox="0 0 120 120" class="rotate180"><use href="#svg-flower"/></svg></td>
              <td><svg viewBox="0 0 120 120" class="squeeze"><use href="#svg-flower"/></svg></td>
              <td><svg viewBox="0 0 120 120" class="gray"><use href="#svg-flower"/></svg></td>
            </tr>
            <!-- House -->
            <tr>
              <td><svg viewBox="0 0 120 120"><use href="#svg-house"/></svg></td>
              <td><svg viewBox="0 0 120 120" class="mirror"><use href="#svg-house"/></svg></td>
              <td><svg viewBox="0 0 120 120" class="rotate180"><use href="#svg-house"/></svg></td>
              <td><svg viewBox="0 0 120 120" class="squeeze"><use href="#svg-house"/></svg></td>
              <td><svg viewBox="0 0 120 120" class="gray"><use href="#svg-house"/></svg></td>
            </tr>
            <!-- Goat -->
            <tr>
              <td><svg viewBox="0 0 120 120"><use href="#svg-goat"/></svg></td>
              <td><svg viewBox="0 0 120 120" class="mirror"><use href="#svg-goat"/></svg></td>
              <td><svg viewBox="0 0 120 120" class="rotate180"><use href="#svg-goat"/></svg></td>
              <td><svg viewBox="0 0 120 120" class="squeeze"><use href="#svg-goat"/></svg></td>
              <td><svg viewBox="0 0 120 120" class="gray"><use href="#svg-goat"/></svg></td>
            </tr>
            <!-- Moon -->
            <tr>
              <td><svg viewBox="0 0 120 120"><use href="#svg-moon"/></svg></td>
              <td><svg viewBox="0 0 120 120" class="mirror"><use href="#svg-moon"/></svg></td>
              <td><svg viewBox="0 0 120 120" class="rotate180"><use href="#svg-moon"/></svg></td>
              <td><svg viewBox="0 0 120 120" class="squeeze"><use href="#svg-moon"/></svg></td>
              <td><svg viewBox="0 0 120 120" class="gray"><use href="#svg-moon"/></svg></td>
            </tr>
            <!-- Grass -->
            <tr>
              <td><svg viewBox="0 0 120 120"><use href="#svg-grass"/></svg></td>
              <td><svg viewBox="0 0 120 120" class="mirror"><use href="#svg-grass"/></svg></td>
              <td><svg viewBox="0 0 120 120" class="rotate180"><use href="#svg-grass"/></svg></td>
              <td><svg viewBox="0 0 120 120" class="squeeze"><use href="#svg-grass"/></svg></td>
              <td><svg viewBox="0 0 120 120" class="gray"><use href="#svg-grass"/></svg></td>
            </tr>
            <!-- Cow -->
            <tr>
              <td><svg viewBox="0 0 120 120"><use href="#svg-cow"/></svg></td>
              <td><svg viewBox="0 0 120 120" class="mirror"><use href="#svg-cow"/></svg></td>
              <td><svg viewBox="0 0 120 120" class="rotate180"><use href="#svg-cow"/></svg></td>
              <td><svg viewBox="0 0 120 120" class="squeeze"><use href="#svg-cow"/></svg></td>
              <td><svg viewBox="0 0 120 120" class="gray"><use href="#svg-cow"/></svg></td>
            </tr>
            <!-- Fish -->
            <tr>
              <td><svg viewBox="0 0 120 120"><use href="#svg-fish"/></svg></td>
              <td><svg viewBox="0 0 120 120" class="mirror"><use href="#svg-fish"/></svg></td>
              <td><svg viewBox="0 0 120 120" class="rotate180"><use href="#svg-fish"/></svg></td>
              <td><svg viewBox="0 0 120 120" class="squeeze"><use href="#svg-fish"/></svg></td>
              <td><svg viewBox="0 0 120 120" class="gray"><use href="#svg-fish"/></svg></td>
            </tr>
          </tbody>
        </table>
      </section>

      <!-- ================= Assignment 3 ================= -->
      <section id="a3" class="a3">
        <h2>Assignment 3 – D3 Chart Recreation Collection</h2>
        <p class="section-note">
          This section preserves the five D3 charts from Assignment 3:
          parallelogram vectors, frequency area chart, Venn-like diagram,
          bar chart, and Gaussian curves.
        </p>

        <h3>Chart 1 – Parallelogram Recreation</h3>
        <figure>
          <svg id="chart1" class="chart" width="900" height="300"></svg>
          <figcaption>
            <strong>Figure note.</strong> Parallelogram of vectors with arrowheads, gridlines,
            transitions, and hover tooltips describing each vector.
          </figcaption>
        </figure>

        <hr class="divider" />

        <h3>Chart 2 – Frequency Chart Recreation</h3>
        <figure>
          <svg id="chart2" class="chart" width="900" height="300"></svg>
          <figcaption>
            <strong>Figure note.</strong> Layered area chart for “Vector” base and extra
            frequencies, with linear interpolation and soft time gating.
          </figcaption>
        </figure>

        <hr class="divider" />

        <h3>Chart 3 – Venn-style Recreation</h3>
        <figure>
          <svg id="chart3" class="chart" width="900" height="300"></svg>
          <figcaption>
            <strong>Figure note.</strong> Overlapping circles with Roman numerals and
            category labels positioned using helper functions.
          </figcaption>
        </figure>

        <hr class="divider" />

        <h3>Chart 4 – Bar Chart Recreation</h3>
        <figure>
          <svg id="chart4" class="chart" width="900" height="300"></svg>
          <figcaption>
            <strong>Figure note.</strong> Paired bars with solid yellow and dashed outlines,
            animated growth, and a rectangular panel border.
          </figcaption>
        </figure>

        <hr class="divider" />

        <h3>Chart 5 – Gaussian Curve Recreation</h3>
        <figure>
          <svg id="chart5" class="chart" width="900" height="300"></svg>
          <figcaption>
            <strong>Figure note.</strong> Two Gaussian curves with shaded areas, dashed
            vertical boundaries, gridlines, and a vertical y-axis label.
          </figcaption>
        </figure>
      </section>

      <!-- ================= Assignment 4 ================= -->
      <section id="a4" class="a4">
        <h2>Assignment 4 – Robustness Grouped Bar Chart</h2>
        <p class="section-note">
          This section reuses the interactive grouped bar chart from Assignment 4.
          Buttons select metric (Standard, CRR, CRA) and dataset (CIFAR-100, CIFAR-10,
          SVHN, MNIST); tooltips show exact values; the summary lists best and worst
          methods per dataset.
        </p>

        <h3>Adversarial Training Results – Bar Chart with D3.js</h3>
        <p>
          Data option: groups of data (Standard Accuracy, Certified Robustness Rate,
          Certified Robust Accuracy) across multiple datasets.
        </p>

        <div class="controls">
          <span>Metric:</span>
          <button class="metric-btn active" data-metric="standard">Standard Accuracy</button>
          <button class="metric-btn" data-metric="crr">Certified Robustness Rate</button>
          <button class="metric-btn" data-metric="cra">Certified Robust Accuracy</button>
        </div>

        <div class="controls">
          <span>Dataset:</span>
          <button class="dataset-btn active" data-dataset="CIFAR-100">CIFAR-100</button>
          <button class="dataset-btn" data-dataset="CIFAR-10">CIFAR-10</button>
          <button class="dataset-btn" data-dataset="SVHN">SVHN</button>
          <button class="dataset-btn" data-dataset="MNIST">MNIST</button>
        </div>

        <svg id="chart" width="900" height="480"></svg>
        <div id="tooltip" class="tooltip" style="opacity:0;"></div>

        <div id="summary">
          <h3>Best and worst methods for each dataset</h3>
          <ul id="summary-list"></ul>
        </div>
      </section>
    </main>
  </div>

  <!-- ========== Scripts ========== -->

  <!-- Assignment 1 script: PSI API fetch + table rendering -->
  <script>
    const PSI_API =
      "https://api.data.gov.sg/v1/environment/psi?date=" +
      new Date().toISOString().slice(0, 10);

    const btnLoad = document.getElementById("btnLoad");
    const jsonPreview = document.getElementById("jsonPreview");
    const psiTableBody = document.querySelector("#psiTable tbody");

    function renderTable(result) {
      psiTableBody.innerHTML = "";
      const items = result.items && result.items[0];
      if (!items || !items.readings || !result.region_metadata) {
        psiTableBody.innerHTML =
          '<tr><td colspan="13">No PSI data available.</td></tr>';
        return;
      }

      const regions = result.region_metadata.map(r => r.name.toLowerCase());
      const readings = items.readings;

      regions.forEach(region => {
        const row = document.createElement("tr");

        function getValue(key) {
          const set = readings[key];
          return set && set[region] != null ? set[region] : "-";
        }

        const cells = [
          region,
          getValue("o3_sub_index"),
          getValue("pm10_twenty_four_hourly"),
          getValue("pm10_sub_index"),
          getValue("co_sub_index"),
          getValue("pm25_twenty_four_hourly"),
          getValue("so2_sub_index"),
          getValue("co_eight_hour_max"),
          getValue("no2_one_hour_max"),
          getValue("so2_twenty_four_hourly"),
          getValue("pm25_sub_index"),
          getValue("psi_twenty_four_hourly"),
          getValue("o3_eight_hour_max")
        ];

        cells.forEach(val => {
          const td = document.createElement("td");
          td.textContent = typeof val === "number" ? val.toFixed(2) : val;
          row.appendChild(td);
        });
        psiTableBody.appendChild(row);
      });
    }

    btnLoad.addEventListener("click", async () => {
      jsonPreview.textContent = "Loading...";
      try {
        const res = await fetch(PSI_API);
        const data = await res.json();
        jsonPreview.textContent = JSON.stringify(data, null, 2);
        renderTable(data);
      } catch (err) {
        jsonPreview.textContent = "Error: " + err.message;
      }
    });

    // auto-load once when the page opens
    window.addEventListener("load", () => {
      btnLoad.click();
    });
  </script>

  <!-- Assignment 3 charts (1–5) -->
  <script>
    /* ...这里保留你之前的 Chart1–Chart5 代码，我不再重复粘贴... */
    /* 为节省篇幅，你可以直接用你当前版本的 Chart 代码替换这段注释 */
  </script>

  <!-- Assignment 4 script -->
  <script>
    const metricConfig = {
      standard: { key: "standard", label: "Standard Accuracy (%)" },
      crr:      { key: "crr",      label: "Certified Robustness Rate (%)" },
      cra:      { key: "cra",      label: "Certified Robust Accuracy (%)" }
    };

    const datasets = ["CIFAR-100", "CIFAR-10", "SVHN", "MNIST"];

    let currentMetric  = "standard";
    let currentDataset = "CIFAR-100";  // 默认和按钮保持一致

    d3.json("data_1.json").then(initChart);

    function initChart(data) {
      const svg = d3.select("#chart");
      const width  = +svg.attr("width");
      const height = +svg.attr("height");

      const margin = { top: 40, right: 30, bottom: 70, left: 70 };
      const innerWidth  = width  - margin.left - margin.right;
      const innerHeight = height - margin.top  - margin.bottom;

      const g = svg.append("g")
                   .attr("transform", `translate(${margin.left},${margin.top})`);

      const approaches = data.map(d => d.approach);

      const color = d3.scaleOrdinal()
        .domain(approaches)
        .range(d3.schemeTableau10.concat(d3.schemeSet3));

      const x = d3.scaleBand()
        .domain(approaches)
        .range([0, innerWidth])
        .padding(0.2);

      const y = d3.scaleLinear()
        .range([innerHeight, 0]);

      g.append("g")
        .attr("transform", `translate(0,${innerHeight})`)
        .call(d3.axisBottom(x))
        .selectAll("text")
        .attr("transform", "rotate(-35)")
        .style("text-anchor", "end");

      const yAxisG = g.append("g").attr("class", "y-axis");

      const yLabel = g.append("text")
        .attr("x", -innerHeight / 2)
        .attr("y", -48)
        .attr("transform", "rotate(-90)")
        .attr("text-anchor", "middle")
        .style("font-size", 13)
        .text(metricConfig[currentMetric].label + " – " + currentDataset);

      const tooltip = d3.select("#tooltip");

      const bars = g.selectAll("rect.bar")
        .data(data)
        .enter()
        .append("rect")
        .attr("class", "bar")
        .attr("x", d => x(d.approach))
        .attr("width", x.bandwidth())
        .attr("y", innerHeight)
        .attr("height", 0)
        .attr("fill", d => color(d.approach))
        .on("mousemove", (event, d) => {
          const val = d[metricConfig[currentMetric].key][currentDataset];
          tooltip.style("opacity", 1)
            .style("left", (event.pageX + 10) + "px")
            .style("top",  (event.pageY + 10) + "px")
            .html(
              `<b>${d.approach}</b><br/>
               Metric: ${metricConfig[currentMetric].label}<br/>
               Dataset: ${currentDataset}<br/>
               Value: ${val.toFixed(2)}`
            );
        })
        .on("mouseleave", () => tooltip.style("opacity", 0));

      function updateChart(animate = true) {
        const metricKey = metricConfig[currentMetric].key;
        const values = data.map(d => d[metricKey][currentDataset]);
        const maxVal = d3.max(values);

        y.domain([0, maxVal]).nice();

        const t = animate ? svg.transition().duration(800) : svg;

        yAxisG.transition(t).call(d3.axisLeft(y));
        yLabel.text(metricConfig[currentMetric].label + " – " + currentDataset);

        bars.transition(t)
          .attr("x", d => x(d.approach))
          .attr("width", x.bandwidth())
          .attr("y", d => y(d[metricKey][currentDataset]))
          .attr("height", d => innerHeight - y(d[metricKey][currentDataset]))
          .attr("fill", d => color(d.approach));
      }

      function updateSummary() {
        const metricKey = metricConfig[currentMetric].key;
        const ul = d3.select("#summary-list");
        ul.selectAll("li").remove();

        datasets.forEach(ds => {
          let best = null, worst = null;
          data.forEach(row => {
            const val = row[metricKey][ds];
            if (best === null || val > best.value) best = { method: row.approach, value: val };
            if (worst === null || val < worst.value) worst = { method: row.approach, value: val };
          });

          ul.append("li")
            .text(
              `${ds}: best = ${best.method} (${best.value.toFixed(2)}), ` +
              `worst = ${worst.method} (${worst.value.toFixed(2)})`
            );
        });
      }

      updateChart(true);
      updateSummary();

      d3.selectAll("button.metric-btn").on("click", function() {
        currentMetric = this.getAttribute("data-metric");
        d3.selectAll("button.metric-btn").classed("active", false);
        d3.select(this).classed("active", true);
        updateChart(true);
        updateSummary();
      });

      d3.selectAll("button.dataset-btn").on("click", function() {
        currentDataset = this.getAttribute("data-dataset");
        d3.selectAll("button.dataset-btn").classed("active", false);
        d3.select(this).classed("active", true);
        updateChart(true);
      });
    }
  </script>
</body>
</html>
